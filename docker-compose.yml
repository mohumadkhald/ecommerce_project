version: '3.8'

services:
    app-java:
        build: .
        image: mohumadkhald/docker-myapp:10.0
        ports:
            - "8080:8080"
        environment:
            SPRING_DATASOURCE_URL: jdbc:mariadb://host.docker.internal:3306/ecommerce
            SPRING_DATASOURCE_USERNAME: ${MYSQL_USER}
            SPRING_DATASOURCE_PASSWORD: ${MYSQL_PASSWORD}
            SPRING_JPA_DATABASE_PLATFORM: org.hibernate.dialect.MySQLDialect
            SPRING_JPA_HIBERNATE_DDL_AUTO: update
        extra_hosts:
            - "host.docker.internal:host-gateway"
        volumes:
            - ./uploads:/usr/app/uploads

    some-mariadb:
        image: mariadb:latest
        container_name: some-mariadb
        environment:
            MARIADB_DATABASE: ${DB_NAME}
            MARIADB_USER: ${MYSQL_USER}
            MARIADB_PASSWORD: ${MYSQL_PASSWORD}
            MARIADB_ROOT_PASSWORD: ${MYSQL_PASSWORD}
        volumes:
            - maria-data:/var/lib/mysql


    phpmyadmin:
        image: phpmyadmin
        restart: always
        environment:
            PMA_HOST: some-mariadb
            PMA_PORT: 3306
            # PMA_USER: ${MYSQL_USER}
            # PMA_PASSWORD: ${MYSQL_PASSWORD}
        ports:
            - "8081:80"
        depends_on:
            - some-mariadb


volumes:
    maria-data:
        driver: local













#    MYSQL_DATABASE="railway"
#    MYSQL_USER="root"
#    MYSQL_PASSWORD="WWHhDyKzVYquuWOzJNLliHmRUvQCOUnR"
#    MYSQL_HOST="switchback.proxy.rlwy.net"
#    MYSQL_PORT="13316"
#    SPRING_DATASOURCE_URL="jdbc:mariadb://${MYSQL_HOST}:${MYSQL_PORT}/${MYSQL_DATABASE}"
#    SPRING_DATASOURCE_USERNAME="${MYSQL_USER}"
#    SPRING_DATASOURCE_PASSWORD="${MYSQL_PASSWORD}"
#    SPRING_DATASOURCE_DRIVER_CLASS_NAME="org.mariadb.jdbc.Driver"
#    SPRING_JPA_DATABASE_PLATFORM="org.hibernate.dialect.MariaDBDialect"
#    SPRING_JPA_HIBERNATE_DDL_AUTO="update"